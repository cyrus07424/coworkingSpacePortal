# Slack通知機能

このアプリケーションはSlackへの通知機能を搭載しています。

## 設定

### 環境変数

Slack通知を有効にするには、以下の環境変数を設定してください：

```
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX
```

この環境変数が設定されていない場合、Slack通知は無効になります。

### Slack Webhook URLの取得方法

1. Slackワークスペースで「Incoming Webhooks」Appを追加
2. 通知を送信したいチャンネルを選択
3. 生成されたWebhook URLを`SLACK_WEBHOOK_URL`環境変数に設定

## 通知イベント

以下のイベントでSlack通知が送信されます：

### ユーザー関連
- **新規ユーザー登録**: 新しいユーザーがアカウントを作成した時
- **ユーザーログイン**: ユーザーがログインした時
- **スタッフユーザー作成**: 管理者がスタッフユーザーを作成した時

### 機材関連
- **機材登録**: 新しい機材が登録された時
- **機材更新**: 機材情報が更新された時
- **機材削除**: 機材が削除された時

### 予約関連
- **機材予約**: 機材が予約された時
- **予約キャンセル**: 予約がキャンセルされた時

## 通知内容

各通知には以下の情報が含まれます：

- **ユーザー情報**: 操作を行ったユーザー名
- **IPアドレス**: 操作元のIPアドレス（X-Forwarded-For、X-Real-IPヘッダーに対応）
- **User Agent**: 使用されたブラウザ/クライアント情報
- **操作内容**: 実行された具体的な操作
- **対象**: 操作の対象（ユーザー名、機材名など）

## セキュリティ考慮事項

- Slack通知の送信に失敗してもメインアプリケーションの処理は中断されません
- 通知は非同期で送信されるため、パフォーマンスへの影響は最小限です
- IPアドレスの取得では、プロキシやロードバランサーのヘッダー（X-Forwarded-For、X-Real-IP）を考慮します

## 開発・テスト

### 単体テスト

```bash
sbt "testOnly services.SlackNotificationServiceTest"
```

### Slack通知の無効化

環境変数`SLACK_WEBHOOK_URL`を設定しない、または空文字列に設定することで通知を無効化できます。

### デバッグ

Slack通知の送信エラーは標準エラー出力に記録されます。本番環境では適切なログ設定を行ってください。